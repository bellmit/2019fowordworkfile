create or replace package ETL_process_AICS is
  procedure update_account_bankinfo;
  procedure update_asset_loanaccount_info;
  procedure update_creditor_vary_relation;
  procedure update_customer_info;
  procedure update_equity_assets_info;
  procedure update_invest_contract;
  procedure update_invest_fundvary;
  procedure update_invest_profitdetail;
  procedure update_project_info;
  procedure update_repay_info;
  procedure update_log(source_sheet      varchar2,
                       target_sheet      varchar2,
                       query_date        date,
                       success_status    varchar2,
                       exception_message varchar2 DEFAULT NULL);

end ETL_process_AICS;
/
create or replace package body ETL_process_AICS is

  --update_account_bankinfo
  procedure update_account_bankinfo is
    query_date date;
  begin
    -- save query_date from etl_control
    select data_date
      into query_date
      from ETL_CONTROL.CTL_GENERAL_PARAMETER;
    -- remove duplicated record identified by data_date
    delete from STD_LAYER.t08_account_bankinfo
     where start_date = query_date;
    update STD_LAYER.t08_account_bankinfo
       set end_date = to_date('9999-12-31', 'yyyy/mm/dd')
     where end_date = query_date;
  
    merge into STD_LAYER.t08_account_bankinfo HIS
    using (select accobelong,
                  accocheckserviceprotocol,
                  accofunction,
                  accomanageprotocol,
                  acconame,
                  accoproperty,
                  accotype,
                  accountmemo,
                  accounttotal,
                  address,
                  agentbank,
                  agentbankaccount,
                  applyer,
                  applyid,
                  archive_reviewer,
                  archive_status,
                  archive_user,
                  area,
                  areacode,
                  attribute,
                  audittype,
                  authushieldnum,
                  bankacco,
                  bankname,
                  bankno,
                  bankrate,
                  bigpaysystemno,
                  calinteresttype,
                  cancelaccoapplication,
                  cancelaccopaper,
                  canceler,
                  cancelexplain,
                  cancelstatus,
                  changecontent,
                  cityno,
                  counterbillsavetype,
                  counterremittype,
                  createuser,
                  deposittype,
                  ebankkey,
                  enteruser,
                  fileno,
                  fundtrustee,
                  guarantee_bank_code,
                  guarantee_bank_no,
                  havecanflg,
                  havereceiptflg,
                  is_rate_fixed,
                  is_suspended,
                  iscancel,
                  iscustodial,
                  isreview,
                  issavefile,
                  issetsubaccount,
                  isuseaccount,
                  jrxxkzbh,
                  jrxxkzhm,
                  keepbakcontracttype,
                  keepbankname,
                  moneytype,
                  nameinbank,
                  oddway,
                  onlinebankoperator,
                  openaccoapplication,
                  openaccountdate,
                  openebankpay,
                  openebanksearch,
                  opener,
                  operator,
                  organcode,
                  otherremittype,
                  otherrtnreceipt,
                  productcategory,
                  projectcode,
                  publicflg,
                  receiptflg,
                  rejecttype,
                  sealapproval,
                  sealauditor,
                  sealcard,
                  sealoperator,
                  seals,
                  sealsavetype,
                  sealseals,
                  sealsealsavetype,
                  status,
                  swiftcode,
                  tradeid,
                  transtype,
                  updateuser,
                  webbankcancelrtnreceipt,
                  webbankopenrtnreceipt,
                  zhdzpd,
                  zhglqk,
                  zhswbgfs,
                  zhyjbgfs,
                  archive_time,
                  cancelaccodate,
                  cancelapprovedate,
                  changedate,
                  createtime,
                  delaydate,
                  enabledate,
                  enddate,
                  expiredate,
                  lastmodifydate,
                  openaccodate,
                  reviewtime,
                  setdate,
                  valuedate,
                  accoid,
                  banknobrac,
                  rate,
                  retainage_id,
                  serialno
             from SRC_LAYER.aics_account_bankinfo
           minus
           select accobelong,
                  accocheckserviceprotocol,
                  accofunction,
                  accomanageprotocol,
                  acconame,
                  accoproperty,
                  accotype,
                  accountmemo,
                  accounttotal,
                  address,
                  agentbank,
                  agentbankaccount,
                  applyer,
                  applyid,
                  archive_reviewer,
                  archive_status,
                  archive_user,
                  area,
                  areacode,
                  attribute,
                  audittype,
                  authushieldnum,
                  bankacco,
                  bankname,
                  bankno,
                  bankrate,
                  bigpaysystemno,
                  calinteresttype,
                  cancelaccoapplication,
                  cancelaccopaper,
                  canceler,
                  cancelexplain,
                  cancelstatus,
                  changecontent,
                  cityno,
                  counterbillsavetype,
                  counterremittype,
                  createuser,
                  deposittype,
                  ebankkey,
                  enteruser,
                  fileno,
                  fundtrustee,
                  guarantee_bank_code,
                  guarantee_bank_no,
                  havecanflg,
                  havereceiptflg,
                  is_rate_fixed,
                  is_suspended,
                  iscancel,
                  iscustodial,
                  isreview,
                  issavefile,
                  issetsubaccount,
                  isuseaccount,
                  jrxxkzbh,
                  jrxxkzhm,
                  keepbakcontracttype,
                  keepbankname,
                  moneytype,
                  nameinbank,
                  oddway,
                  onlinebankoperator,
                  openaccoapplication,
                  openaccountdate,
                  openebankpay,
                  openebanksearch,
                  opener,
                  operator,
                  organcode,
                  otherremittype,
                  otherrtnreceipt,
                  productcategory,
                  projectcode,
                  publicflg,
                  receiptflg,
                  rejecttype,
                  sealapproval,
                  sealauditor,
                  sealcard,
                  sealoperator,
                  seals,
                  sealsavetype,
                  sealseals,
                  sealsealsavetype,
                  status,
                  swiftcode,
                  tradeid,
                  transtype,
                  updateuser,
                  webbankcancelrtnreceipt,
                  webbankopenrtnreceipt,
                  zhdzpd,
                  zhglqk,
                  zhswbgfs,
                  zhyjbgfs,
                  archive_time,
                  cancelaccodate,
                  cancelapprovedate,
                  changedate,
                  createtime,
                  delaydate,
                  enabledate,
                  enddate,
                  expiredate,
                  lastmodifydate,
                  openaccodate,
                  reviewtime,
                  setdate,
                  valuedate,
                  accoid,
                  banknobrac,
                  rate,
                  retainage_id,
                  serialno
           
             from STD_LAYER.t08_account_bankinfo) DIF
    on (HIS.acconame = DIF.acconame)
    when matched then
      update set HIS.end_date = query_date;
    -- insert the nonredundant(new) records
    insert into STD_LAYER.t08_account_bankinfo
      select accobelong,
             accocheckserviceprotocol,
             accofunction,
             accomanageprotocol,
             acconame,
             accoproperty,
             accotype,
             accountmemo,
             accounttotal,
             address,
             agentbank,
             agentbankaccount,
             applyer,
             applyid,
             archive_reviewer,
             archive_status,
             archive_user,
             area,
             areacode,
             attribute,
             audittype,
             authushieldnum,
             bankacco,
             bankname,
             bankno,
             bankrate,
             bigpaysystemno,
             calinteresttype,
             cancelaccoapplication,
             cancelaccopaper,
             canceler,
             cancelexplain,
             cancelstatus,
             changecontent,
             cityno,
             counterbillsavetype,
             counterremittype,
             createuser,
             deposittype,
             ebankkey,
             enteruser,
             fileno,
             fundtrustee,
             guarantee_bank_code,
             guarantee_bank_no,
             havecanflg,
             havereceiptflg,
             is_rate_fixed,
             is_suspended,
             iscancel,
             iscustodial,
             isreview,
             issavefile,
             issetsubaccount,
             isuseaccount,
             jrxxkzbh,
             jrxxkzhm,
             keepbakcontracttype,
             keepbankname,
             moneytype,
             nameinbank,
             oddway,
             onlinebankoperator,
             openaccoapplication,
             openaccountdate,
             openebankpay,
             openebanksearch,
             opener,
             operator,
             organcode,
             otherremittype,
             otherrtnreceipt,
             productcategory,
             projectcode,
             publicflg,
             receiptflg,
             rejecttype,
             sealapproval,
             sealauditor,
             sealcard,
             sealoperator,
             seals,
             sealsavetype,
             sealseals,
             sealsealsavetype,
             status,
             swiftcode,
             tradeid,
             transtype,
             updateuser,
             webbankcancelrtnreceipt,
             webbankopenrtnreceipt,
             zhdzpd,
             zhglqk,
             zhswbgfs,
             zhyjbgfs,
             archive_time,
             cancelaccodate,
             cancelapprovedate,
             changedate,
             createtime,
             delaydate,
             enabledate,
             enddate,
             expiredate,
             lastmodifydate,
             openaccodate,
             reviewtime,
             setdate,
             valuedate,
             accoid,
             banknobrac,
             rate,
             retainage_id,
             serialno,
             sysdate,
             datadate,
             to_date('9999-12-31', 'yyyy/mm/dd')
        from SRC_LAYER.aics_account_bankinfo
       where acconame not in
             (select acconame
                from (select accobelong,
                             accocheckserviceprotocol,
                             accofunction,
                             accomanageprotocol,
                             acconame,
                             accoproperty,
                             accotype,
                             accountmemo,
                             accounttotal,
                             address,
                             agentbank,
                             agentbankaccount,
                             applyer,
                             applyid,
                             archive_reviewer,
                             archive_status,
                             archive_user,
                             area,
                             areacode,
                             attribute,
                             audittype,
                             authushieldnum,
                             bankacco,
                             bankname,
                             bankno,
                             bankrate,
                             bigpaysystemno,
                             calinteresttype,
                             cancelaccoapplication,
                             cancelaccopaper,
                             canceler,
                             cancelexplain,
                             cancelstatus,
                             changecontent,
                             cityno,
                             counterbillsavetype,
                             counterremittype,
                             createuser,
                             deposittype,
                             ebankkey,
                             enteruser,
                             fileno,
                             fundtrustee,
                             guarantee_bank_code,
                             guarantee_bank_no,
                             havecanflg,
                             havereceiptflg,
                             is_rate_fixed,
                             is_suspended,
                             iscancel,
                             iscustodial,
                             isreview,
                             issavefile,
                             issetsubaccount,
                             isuseaccount,
                             jrxxkzbh,
                             jrxxkzhm,
                             keepbakcontracttype,
                             keepbankname,
                             moneytype,
                             nameinbank,
                             oddway,
                             onlinebankoperator,
                             openaccoapplication,
                             openaccountdate,
                             openebankpay,
                             openebanksearch,
                             opener,
                             operator,
                             organcode,
                             otherremittype,
                             otherrtnreceipt,
                             productcategory,
                             projectcode,
                             publicflg,
                             receiptflg,
                             rejecttype,
                             sealapproval,
                             sealauditor,
                             sealcard,
                             sealoperator,
                             seals,
                             sealsavetype,
                             sealseals,
                             sealsealsavetype,
                             status,
                             swiftcode,
                             tradeid,
                             transtype,
                             updateuser,
                             webbankcancelrtnreceipt,
                             webbankopenrtnreceipt,
                             zhdzpd,
                             zhglqk,
                             zhswbgfs,
                             zhyjbgfs,
                             archive_time,
                             cancelaccodate,
                             cancelapprovedate,
                             changedate,
                             createtime,
                             delaydate,
                             enabledate,
                             enddate,
                             expiredate,
                             lastmodifydate,
                             openaccodate,
                             reviewtime,
                             setdate,
                             valuedate,
                             accoid,
                             banknobrac,
                             rate,
                             retainage_id,
                             serialno
                        from SRC_LAYER.aics_account_bankinfo
                      intersect
                      select accobelong,
                             accocheckserviceprotocol,
                             accofunction,
                             accomanageprotocol,
                             acconame,
                             accoproperty,
                             accotype,
                             accountmemo,
                             accounttotal,
                             address,
                             agentbank,
                             agentbankaccount,
                             applyer,
                             applyid,
                             archive_reviewer,
                             archive_status,
                             archive_user,
                             area,
                             areacode,
                             attribute,
                             audittype,
                             authushieldnum,
                             bankacco,
                             bankname,
                             bankno,
                             bankrate,
                             bigpaysystemno,
                             calinteresttype,
                             cancelaccoapplication,
                             cancelaccopaper,
                             canceler,
                             cancelexplain,
                             cancelstatus,
                             changecontent,
                             cityno,
                             counterbillsavetype,
                             counterremittype,
                             createuser,
                             deposittype,
                             ebankkey,
                             enteruser,
                             fileno,
                             fundtrustee,
                             guarantee_bank_code,
                             guarantee_bank_no,
                             havecanflg,
                             havereceiptflg,
                             is_rate_fixed,
                             is_suspended,
                             iscancel,
                             iscustodial,
                             isreview,
                             issavefile,
                             issetsubaccount,
                             isuseaccount,
                             jrxxkzbh,
                             jrxxkzhm,
                             keepbakcontracttype,
                             keepbankname,
                             moneytype,
                             nameinbank,
                             oddway,
                             onlinebankoperator,
                             openaccoapplication,
                             openaccountdate,
                             openebankpay,
                             openebanksearch,
                             opener,
                             operator,
                             organcode,
                             otherremittype,
                             otherrtnreceipt,
                             productcategory,
                             projectcode,
                             publicflg,
                             receiptflg,
                             rejecttype,
                             sealapproval,
                             sealauditor,
                             sealcard,
                             sealoperator,
                             seals,
                             sealsavetype,
                             sealseals,
                             sealsealsavetype,
                             status,
                             swiftcode,
                             tradeid,
                             transtype,
                             updateuser,
                             webbankcancelrtnreceipt,
                             webbankopenrtnreceipt,
                             zhdzpd,
                             zhglqk,
                             zhswbgfs,
                             zhyjbgfs,
                             archive_time,
                             cancelaccodate,
                             cancelapprovedate,
                             changedate,
                             createtime,
                             delaydate,
                             enabledate,
                             enddate,
                             expiredate,
                             lastmodifydate,
                             openaccodate,
                             reviewtime,
                             setdate,
                             valuedate,
                             accoid,
                             banknobrac,
                             rate,
                             retainage_id,
                             serialno
                        from STD_LAYER.t08_account_bankinfo));
    commit;
  
    -- update system log in etl_control
    update_log('SRC_LAYER.aics_account_bankinfo',
               'STD_LAYER.t08_account_bankinfo',
               query_date,
               'yes');
  exception
    -- error handling if exception happens
    when others then
      update_log('SRC_LAYER.aics_account_bankinfo',
                 'STD_LAYER.t08_account_bankinfo',
                 query_date,
                 'no',
                 sqlerrm);
      dbms_output.put_line(sqlerrm);
      rollback;
    
  end update_account_bankinfo;

  --update_asset_loanaccount_info
  procedure update_asset_loanaccount_info is
    query_date date;
  begin
    -- save query_date from etl_control
    select data_date
      into query_date
      from ETL_CONTROL.CTL_GENERAL_PARAMETER;
    -- remove duplicated record identified by data_date
    delete from STD_LAYER.t01_asset_loanaccount_info
     where start_date = query_date;
    update STD_LAYER.t01_asset_loanaccount_info
       set end_date = to_date('9999-12-31', 'yyyy/mm/dd')
     where end_date = query_date;
  
    merge into STD_LAYER.t01_asset_loanaccount_info HIS
    using (select loanaccountcode,
                  loanaccountnum,
                  loanaccountname,
                  loanstatus,
                  projectcode,
                  industrydetail,
                  provincecode,
                  cityno,
                  regioncode,
                  businesscondition,
                  corpusamount,
                  interest,
                  disbursementfee,
                  minquotedprice,
                  maxquotedprice,
                  loanaccountcosts,
                  replayrate,
                  memo,
                  enteruser,
                  entertime,
                  lastupdateuser,
                  lastupdatetime,
                  loanmanager,
                  evaluationuser,
                  reclaimscale,
                  currentscale,
                  quotationscale,
                  disposalyears,
                  balancecost,
                  currentbalance,
                  deductionten,
                  lasttimeloss,
                  lastbalance,
                  qualification,
                  issolvency,
                  ispay,
                  lastamount,
                  recoverablescale,
                  recoverablebalancec,
                  disposalmoney,
                  lastbalanceall,
                  abstract1,
                  abstract2,
                  abstract3,
                  abstract4,
                  abstract5,
                  abstract6,
                  abstract7,
                  abstract8,
                  abstract9,
                  abstract10,
                  setupdate,
                  representative,
                  registemoney,
                  businesscope,
                  address,
                  cykind,
                  relationcode,
                  opertorvaluationdate,
                  transferbalance,
                  fxassetrate,
                  schemeid,
                  isalldeal,
                  assetsource,
                  assetsourcename,
                  abstract11,
                  abstract12,
                  predisposalperiod,
                  defaultinterest,
                  otherfee,
                  subcompanyreceivedate,
                  subcompanyreceivemoney,
                  litigationstatus,
                  mindealprice,
                  entertype,
                  propertynature,
                  escrowstatus,
                  assetseller,
                  baseday,
                  margin_balance,
                  recprecoverablescale,
                  recprecoverablebalance,
                  asset_category,
                  source,
                  is_continue_agency,
                  continue_agency
             from SRC_LAYER.aics_asset_loanaccount_info
           minus
           select loanaccountcode,
                  loanaccountnum,
                  loanaccountname,
                  loanstatus,
                  projectcode,
                  industrydetail,
                  provincecode,
                  cityno,
                  regioncode,
                  businesscondition,
                  corpusamount,
                  interest,
                  disbursementfee,
                  minquotedprice,
                  maxquotedprice,
                  loanaccountcosts,
                  replayrate,
                  memo,
                  enteruser,
                  entertime,
                  lastupdateuser,
                  lastupdatetime,
                  loanmanager,
                  evaluationuser,
                  reclaimscale,
                  currentscale,
                  quotationscale,
                  disposalyears,
                  balancecost,
                  currentbalance,
                  deductionten,
                  lasttimeloss,
                  lastbalance,
                  qualification,
                  issolvency,
                  ispay,
                  lastamount,
                  recoverablescale,
                  recoverablebalancec,
                  disposalmoney,
                  lastbalanceall,
                  abstract1,
                  abstract2,
                  abstract3,
                  abstract4,
                  abstract5,
                  abstract6,
                  abstract7,
                  abstract8,
                  abstract9,
                  abstract10,
                  setupdate,
                  representative,
                  registemoney,
                  businesscope,
                  address,
                  cykind,
                  relationcode,
                  opertorvaluationdate,
                  transferbalance,
                  fxassetrate,
                  schemeid,
                  isalldeal,
                  assetsource,
                  assetsourcename,
                  abstract11,
                  abstract12,
                  predisposalperiod,
                  defaultinterest,
                  otherfee,
                  subcompanyreceivedate,
                  subcompanyreceivemoney,
                  litigationstatus,
                  mindealprice,
                  entertype,
                  propertynature,
                  escrowstatus,
                  assetseller,
                  baseday,
                  margin_balance,
                  recprecoverablescale,
                  recprecoverablebalance,
                  asset_category,
                  source,
                  is_continue_agency,
                  continue_agency
           
             from STD_LAYER.t01_asset_loanaccount_info) DIF
    on (HIS.loanaccountcode = DIF.loanaccountcode)
    when matched then
      update set HIS.end_date = query_date;
    -- insert the nonredundant(new) records
    insert into STD_LAYER.t01_asset_loanaccount_info
      select loanaccountcode,
             loanaccountnum,
             loanaccountname,
             loanstatus,
             projectcode,
             industrydetail,
             provincecode,
             cityno,
             regioncode,
             businesscondition,
             corpusamount,
             interest,
             disbursementfee,
             minquotedprice,
             maxquotedprice,
             loanaccountcosts,
             replayrate,
             memo,
             enteruser,
             entertime,
             lastupdateuser,
             lastupdatetime,
             loanmanager,
             evaluationuser,
             reclaimscale,
             currentscale,
             quotationscale,
             disposalyears,
             balancecost,
             currentbalance,
             deductionten,
             lasttimeloss,
             lastbalance,
             qualification,
             issolvency,
             ispay,
             lastamount,
             recoverablescale,
             recoverablebalancec,
             disposalmoney,
             lastbalanceall,
             abstract1,
             abstract2,
             abstract3,
             abstract4,
             abstract5,
             abstract6,
             abstract7,
             abstract8,
             abstract9,
             abstract10,
             setupdate,
             representative,
             registemoney,
             businesscope,
             address,
             cykind,
             relationcode,
             opertorvaluationdate,
             transferbalance,
             fxassetrate,
             schemeid,
             isalldeal,
             assetsource,
             assetsourcename,
             abstract11,
             abstract12,
             predisposalperiod,
             defaultinterest,
             otherfee,
             subcompanyreceivedate,
             subcompanyreceivemoney,
             litigationstatus,
             mindealprice,
             entertype,
             propertynature,
             escrowstatus,
             assetseller,
             baseday,
             margin_balance,
             recprecoverablescale,
             recprecoverablebalance,
             asset_category,
             source,
             is_continue_agency,
             continue_agency,
             sysdate,
             datadate,
             to_date('9999-12-31', 'yyyy/mm/dd')
        from SRC_LAYER.aics_asset_loanaccount_info
       where loanaccountcode not in
             (select loanaccountcode
                from (select loanaccountcode,
                             loanaccountnum,
                             loanaccountname,
                             loanstatus,
                             projectcode,
                             industrydetail,
                             provincecode,
                             cityno,
                             regioncode,
                             businesscondition,
                             corpusamount,
                             interest,
                             disbursementfee,
                             minquotedprice,
                             maxquotedprice,
                             loanaccountcosts,
                             replayrate,
                             memo,
                             enteruser,
                             entertime,
                             lastupdateuser,
                             lastupdatetime,
                             loanmanager,
                             evaluationuser,
                             reclaimscale,
                             currentscale,
                             quotationscale,
                             disposalyears,
                             balancecost,
                             currentbalance,
                             deductionten,
                             lasttimeloss,
                             lastbalance,
                             qualification,
                             issolvency,
                             ispay,
                             lastamount,
                             recoverablescale,
                             recoverablebalancec,
                             disposalmoney,
                             lastbalanceall,
                             abstract1,
                             abstract2,
                             abstract3,
                             abstract4,
                             abstract5,
                             abstract6,
                             abstract7,
                             abstract8,
                             abstract9,
                             abstract10,
                             setupdate,
                             representative,
                             registemoney,
                             businesscope,
                             address,
                             cykind,
                             relationcode,
                             opertorvaluationdate,
                             transferbalance,
                             fxassetrate,
                             schemeid,
                             isalldeal,
                             assetsource,
                             assetsourcename,
                             abstract11,
                             abstract12,
                             predisposalperiod,
                             defaultinterest,
                             otherfee,
                             subcompanyreceivedate,
                             subcompanyreceivemoney,
                             litigationstatus,
                             mindealprice,
                             entertype,
                             propertynature,
                             escrowstatus,
                             assetseller,
                             baseday,
                             margin_balance,
                             recprecoverablescale,
                             recprecoverablebalance,
                             asset_category,
                             source,
                             is_continue_agency,
                             continue_agency
                        from SRC_LAYER.aics_asset_loanaccount_info
                      intersect
                      select loanaccountcode,
                             loanaccountnum,
                             loanaccountname,
                             loanstatus,
                             projectcode,
                             industrydetail,
                             provincecode,
                             cityno,
                             regioncode,
                             businesscondition,
                             corpusamount,
                             interest,
                             disbursementfee,
                             minquotedprice,
                             maxquotedprice,
                             loanaccountcosts,
                             replayrate,
                             memo,
                             enteruser,
                             entertime,
                             lastupdateuser,
                             lastupdatetime,
                             loanmanager,
                             evaluationuser,
                             reclaimscale,
                             currentscale,
                             quotationscale,
                             disposalyears,
                             balancecost,
                             currentbalance,
                             deductionten,
                             lasttimeloss,
                             lastbalance,
                             qualification,
                             issolvency,
                             ispay,
                             lastamount,
                             recoverablescale,
                             recoverablebalancec,
                             disposalmoney,
                             lastbalanceall,
                             abstract1,
                             abstract2,
                             abstract3,
                             abstract4,
                             abstract5,
                             abstract6,
                             abstract7,
                             abstract8,
                             abstract9,
                             abstract10,
                             setupdate,
                             representative,
                             registemoney,
                             businesscope,
                             address,
                             cykind,
                             relationcode,
                             opertorvaluationdate,
                             transferbalance,
                             fxassetrate,
                             schemeid,
                             isalldeal,
                             assetsource,
                             assetsourcename,
                             abstract11,
                             abstract12,
                             predisposalperiod,
                             defaultinterest,
                             otherfee,
                             subcompanyreceivedate,
                             subcompanyreceivemoney,
                             litigationstatus,
                             mindealprice,
                             entertype,
                             propertynature,
                             escrowstatus,
                             assetseller,
                             baseday,
                             margin_balance,
                             recprecoverablescale,
                             recprecoverablebalance,
                             asset_category,
                             source,
                             is_continue_agency,
                             continue_agency
                        from STD_LAYER.t01_asset_loanaccount_info));
    commit;
  
    -- update system log in etl_control
    update_log('SRC_LAYER.aics_asset_loanaccount_info',
               'STD_LAYER.t01_asset_loanaccount_info',
               query_date,
               'yes');
  exception
    -- error handling if exception happens
    when others then
      update_log('SRC_LAYER.aics_asset_loanaccount_info',
                 'STD_LAYER.t01_asset_loanaccount_info',
                 query_date,
                 'no',
                 sqlerrm);
      dbms_output.put_line(sqlerrm);
      rollback;
  end update_asset_loanaccount_info;

  --update_creditor_vary_relation
  procedure update_creditor_vary_relation is
    query_date date;
  begin
    -- save query_date from etl_control
    select data_date
      into query_date
      from ETL_CONTROL.CTL_GENERAL_PARAMETER;
    -- remove duplicated record identified by data_date
    delete from STD_LAYER.t08_creditor_vary_relation
     where start_date = query_date;
    update STD_LAYER.t08_creditor_vary_relation
       set end_date = to_date('9999-12-31', 'yyyy/mm/dd')
     where end_date = query_date;
  
    merge into STD_LAYER.t08_creditor_vary_relation HIS
    using (select relationid,
                  ijourid,
                  creditorcontractcode,
                  ofeesetcorpusamount,
                  ofeesetinterest
             from SRC_LAYER.aics_creditor_vary_relation
           minus
           select relationid,
                  ijourid,
                  creditorcontractcode,
                  ofeesetcorpusamount,
                  ofeesetinterest
           
             from STD_LAYER.t08_creditor_vary_relation) DIF
    on (HIS.relationid = DIF.relationid)
    when matched then
      update set HIS.end_date = query_date;
    -- insert the nonredundant(new) records
    insert into STD_LAYER.t08_creditor_vary_relation
      select relationid,
             ijourid,
             creditorcontractcode,
             ofeesetcorpusamount,
             ofeesetinterest,
             sysdate,
             datadate,
             to_date('9999-12-31', 'yyyy/mm/dd')
        from SRC_LAYER.aics_creditor_vary_relation
       where relationid not in
             (select relationid
                from (select relationid,
                             ijourid,
                             creditorcontractcode,
                             ofeesetcorpusamount,
                             ofeesetinterest
                        from SRC_LAYER.aics_creditor_vary_relation
                      intersect
                      select relationid,
                             ijourid,
                             creditorcontractcode,
                             ofeesetcorpusamount,
                             ofeesetinterest
                        from STD_LAYER.t08_creditor_vary_relation));
    commit;
  
    -- update system log in etl_control
    update_log('SRC_LAYER.aics_creditor_vary_relation',
               'STD_LAYER.t08_creditor_vary_relation',
               query_date,
               'yes');
  exception
    -- error handling if exception happens
    when others then
      update_log('SRC_LAYER.aics_creditor_vary_relation',
                 'STD_LAYER.t08_creditor_vary_relation',
                 query_date,
                 'no',
                 sqlerrm);
      dbms_output.put_line(sqlerrm);
      rollback;
  end update_creditor_vary_relation;

  --update_customer_info
  procedure update_customer_info is
    query_date date;
  begin
    -- save query_date from etl_control
    select data_date
      into query_date
      from ETL_CONTROL.CTL_GENERAL_PARAMETER;
    -- remove duplicated record identified by data_date
    delete from STD_LAYER.t01_customer_info where start_date = query_date;
    update STD_LAYER.t01_customer_info
       set end_date = to_date('9999-12-31', 'yyyy/mm/dd')
     where end_date = query_date;
  
    merge into STD_LAYER.t01_customer_info HIS
    using (select customercode,
                  customername,
                  customerproperty,
                  certificatetype,
                  certificatecode,
                  customercity,
                  isvalid,
                  createuser,
                  createtime,
                  updateuser,
                  updatetime,
                  entscale,
                  serialno,
                  rejecttype,
                  setupdate,
                  businesscope,
                  area,
                  status,
                  tempcode,
                  rejectcode,
                  listedflag,
                  enablesocialcredit,
                  industrydetail,
                  cino,
                  register_place,
                  nature,
                  qualification,
                  employee_num,
                  credit_date,
                  advance_kind,
                  advance_reason,
                  color_flag,
                  risk_custom_flag,
                  financial_report_flag,
                  finace_impor_custom,
                  flat_custom_flag,
                  develop_borough_flag,
                  yjh_risk_predict_flag,
                  custom_industry_flag,
                  green_credit_flag,
                  land_agent_admittance_flag,
                  cust_state_cisborder,
                  road_belong_department,
                  qualification_level,
                  govern_invest_cust_type,
                  marketing_class,
                  business_country,
                  description,
                  contrast_class,
                  impor_shift_cust,
                  govern_area,
                  belong_area,
                  last_person,
                  last_person_area,
                  staff_code,
                  last_modify_time,
                  customer_status,
                  nature2
             from SRC_LAYER.aics_customer_info
           minus
           select customercode,
                  customername,
                  customerproperty,
                  certificatetype,
                  certificatecode,
                  customercity,
                  isvalid,
                  createuser,
                  createtime,
                  updateuser,
                  updatetime,
                  entscale,
                  serialno,
                  rejecttype,
                  setupdate,
                  businesscope,
                  area,
                  status,
                  tempcode,
                  rejectcode,
                  listedflag,
                  enablesocialcredit,
                  industrydetail,
                  cino,
                  register_place,
                  nature,
                  qualification,
                  employee_num,
                  credit_date,
                  advance_kind,
                  advance_reason,
                  color_flag,
                  risk_custom_flag,
                  financial_report_flag,
                  finace_impor_custom,
                  flat_custom_flag,
                  develop_borough_flag,
                  yjh_risk_predict_flag,
                  custom_industry_flag,
                  green_credit_flag,
                  land_agent_admittance_flag,
                  cust_state_cisborder,
                  road_belong_department,
                  qualification_level,
                  govern_invest_cust_type,
                  marketing_class,
                  business_country,
                  description,
                  contrast_class,
                  impor_shift_cust,
                  govern_area,
                  belong_area,
                  last_person,
                  last_person_area,
                  staff_code,
                  last_modify_time,
                  customer_status,
                  nature2
           
             from STD_LAYER.t01_customer_info) DIF
    on (HIS.customercode = DIF.customercode)
    when matched then
      update set HIS.end_date = query_date;
    -- insert the nonredundant(new) records
    insert into STD_LAYER.t01_customer_info
      select customercode,
             customername,
             customerproperty,
             certificatetype,
             certificatecode,
             customercity,
             isvalid,
             createuser,
             createtime,
             updateuser,
             updatetime,
             entscale,
             serialno,
             rejecttype,
             setupdate,
             businesscope,
             area,
             status,
             tempcode,
             rejectcode,
             listedflag,
             enablesocialcredit,
             industrydetail,
             cino,
             register_place,
             nature,
             qualification,
             employee_num,
             credit_date,
             advance_kind,
             advance_reason,
             color_flag,
             risk_custom_flag,
             financial_report_flag,
             finace_impor_custom,
             flat_custom_flag,
             develop_borough_flag,
             yjh_risk_predict_flag,
             custom_industry_flag,
             green_credit_flag,
             land_agent_admittance_flag,
             cust_state_cisborder,
             road_belong_department,
             qualification_level,
             govern_invest_cust_type,
             marketing_class,
             business_country,
             description,
             contrast_class,
             impor_shift_cust,
             govern_area,
             belong_area,
             last_person,
             last_person_area,
             staff_code,
             last_modify_time,
             customer_status,
             nature2,
             sysdate,
             datadate,
             to_date('9999-12-31', 'yyyy/mm/dd')
        from SRC_LAYER.aics_customer_info
       where customercode not in
             (select customercode
                from (select customercode,
                             customername,
                             customerproperty,
                             certificatetype,
                             certificatecode,
                             customercity,
                             isvalid,
                             createuser,
                             createtime,
                             updateuser,
                             updatetime,
                             entscale,
                             serialno,
                             rejecttype,
                             setupdate,
                             businesscope,
                             area,
                             status,
                             tempcode,
                             rejectcode,
                             listedflag,
                             enablesocialcredit,
                             industrydetail,
                             cino,
                             register_place,
                             nature,
                             qualification,
                             employee_num,
                             credit_date,
                             advance_kind,
                             advance_reason,
                             color_flag,
                             risk_custom_flag,
                             financial_report_flag,
                             finace_impor_custom,
                             flat_custom_flag,
                             develop_borough_flag,
                             yjh_risk_predict_flag,
                             custom_industry_flag,
                             green_credit_flag,
                             land_agent_admittance_flag,
                             cust_state_cisborder,
                             road_belong_department,
                             qualification_level,
                             govern_invest_cust_type,
                             marketing_class,
                             business_country,
                             description,
                             contrast_class,
                             impor_shift_cust,
                             govern_area,
                             belong_area,
                             last_person,
                             last_person_area,
                             staff_code,
                             last_modify_time,
                             customer_status,
                             nature2
                        from SRC_LAYER.aics_customer_info
                      intersect
                      select customercode,
                             customername,
                             customerproperty,
                             certificatetype,
                             certificatecode,
                             customercity,
                             isvalid,
                             createuser,
                             createtime,
                             updateuser,
                             updatetime,
                             entscale,
                             serialno,
                             rejecttype,
                             setupdate,
                             businesscope,
                             area,
                             status,
                             tempcode,
                             rejectcode,
                             listedflag,
                             enablesocialcredit,
                             industrydetail,
                             cino,
                             register_place,
                             nature,
                             qualification,
                             employee_num,
                             credit_date,
                             advance_kind,
                             advance_reason,
                             color_flag,
                             risk_custom_flag,
                             financial_report_flag,
                             finace_impor_custom,
                             flat_custom_flag,
                             develop_borough_flag,
                             yjh_risk_predict_flag,
                             custom_industry_flag,
                             green_credit_flag,
                             land_agent_admittance_flag,
                             cust_state_cisborder,
                             road_belong_department,
                             qualification_level,
                             govern_invest_cust_type,
                             marketing_class,
                             business_country,
                             description,
                             contrast_class,
                             impor_shift_cust,
                             govern_area,
                             belong_area,
                             last_person,
                             last_person_area,
                             staff_code,
                             last_modify_time,
                             customer_status,
                             nature2
                        from STD_LAYER.t01_customer_info));
    commit;
  
    -- update system log in etl_control
    update_log('SRC_LAYER.aics_customer_info',
               'STD_LAYER.t01_customer_info',
               query_date,
               'yes');
  exception
    -- error handling if exception happens
    when others then
      update_log('SRC_LAYER.aics_customer_info',
                 'STD_LAYER.t01_customer_info',
                 query_date,
                 'no',
                 sqlerrm);
      dbms_output.put_line(sqlerrm);
      rollback;
  end update_customer_info;

  --update_equity_assets_info
  procedure update_equity_assets_info is
    query_date date;
  begin
    -- save query_date from etl_control
    select data_date
      into query_date
      from ETL_CONTROL.CTL_GENERAL_PARAMETER;
    -- remove duplicated record identified by data_date
    delete from STD_LAYER.t08_equity_assets_info
     where start_date = query_date;
    update STD_LAYER.t08_equity_assets_info
       set end_date = to_date('9999-12-31', 'yyyy/mm/dd')
     where end_date = query_date;
  
    merge into STD_LAYER.t08_equity_assets_info HIS
    using (select equityassetno,
                  equityassetname,
                  projectcode,
                  assetholder,
                  equitynature,
                  equitybalance,
                  stockamount,
                  equityratio,
                  equitystatus,
                  checkflag,
                  markettype,
                  enterprise,
                  investindustry,
                  cykind,
                  investbalance,
                  remark,
                  heldhandlestatus,
                  rejecttype,
                  propertynature,
                  updateuser,
                  accountvalue,
                  equityassetcode,
                  shareholding,
                  stockcode,
                  releasedate,
                  stockname,
                  holdingnumber,
                  carrycost,
                  carrybalance,
                  latestbalance,
                  predictyield,
                  predictyieldlimit,
                  realinvestdate,
                  serialno,
                  maininvestpart,
                  process_instanceid
             from SRC_LAYER.aics_equity_assets_info
           minus
           select equityassetno,
                  equityassetname,
                  projectcode,
                  assetholder,
                  equitynature,
                  equitybalance,
                  stockamount,
                  equityratio,
                  equitystatus,
                  checkflag,
                  markettype,
                  enterprise,
                  investindustry,
                  cykind,
                  investbalance,
                  remark,
                  heldhandlestatus,
                  rejecttype,
                  propertynature,
                  updateuser,
                  accountvalue,
                  equityassetcode,
                  shareholding,
                  stockcode,
                  releasedate,
                  stockname,
                  holdingnumber,
                  carrycost,
                  carrybalance,
                  latestbalance,
                  predictyield,
                  predictyieldlimit,
                  realinvestdate,
                  serialno,
                  maininvestpart,
                  process_instanceid
           
             from STD_LAYER.t08_equity_assets_info) DIF
    on (HIS.equityassetno = DIF.equityassetno)
    when matched then
      update set HIS.end_date = query_date;
    -- insert the nonredundant(new) records
    insert into STD_LAYER.t08_equity_assets_info
      select equityassetno,
             equityassetname,
             projectcode,
             assetholder,
             equitynature,
             equitybalance,
             stockamount,
             equityratio,
             equitystatus,
             checkflag,
             markettype,
             enterprise,
             investindustry,
             cykind,
             investbalance,
             remark,
             heldhandlestatus,
             rejecttype,
             propertynature,
             updateuser,
             accountvalue,
             equityassetcode,
             shareholding,
             stockcode,
             releasedate,
             stockname,
             holdingnumber,
             carrycost,
             carrybalance,
             latestbalance,
             predictyield,
             predictyieldlimit,
             realinvestdate,
             serialno,
             maininvestpart,
             process_instanceid,
             sysdate,
             datadate,
             to_date('9999-12-31', 'yyyy/mm/dd')
        from SRC_LAYER.aics_equity_assets_info
       where equityassetno not in
             (select equityassetno
                from (select equityassetno,
                             equityassetname,
                             projectcode,
                             assetholder,
                             equitynature,
                             equitybalance,
                             stockamount,
                             equityratio,
                             equitystatus,
                             checkflag,
                             markettype,
                             enterprise,
                             investindustry,
                             cykind,
                             investbalance,
                             remark,
                             heldhandlestatus,
                             rejecttype,
                             propertynature,
                             updateuser,
                             accountvalue,
                             equityassetcode,
                             shareholding,
                             stockcode,
                             releasedate,
                             stockname,
                             holdingnumber,
                             carrycost,
                             carrybalance,
                             latestbalance,
                             predictyield,
                             predictyieldlimit,
                             realinvestdate,
                             serialno,
                             maininvestpart,
                             process_instanceid
                        from SRC_LAYER.aics_equity_assets_info
                      intersect
                      select equityassetno,
                             equityassetname,
                             projectcode,
                             assetholder,
                             equitynature,
                             equitybalance,
                             stockamount,
                             equityratio,
                             equitystatus,
                             checkflag,
                             markettype,
                             enterprise,
                             investindustry,
                             cykind,
                             investbalance,
                             remark,
                             heldhandlestatus,
                             rejecttype,
                             propertynature,
                             updateuser,
                             accountvalue,
                             equityassetcode,
                             shareholding,
                             stockcode,
                             releasedate,
                             stockname,
                             holdingnumber,
                             carrycost,
                             carrybalance,
                             latestbalance,
                             predictyield,
                             predictyieldlimit,
                             realinvestdate,
                             serialno,
                             maininvestpart,
                             process_instanceid
                        from STD_LAYER.t08_equity_assets_info));
    commit;
  
    -- update system log in etl_control
    update_log('SRC_LAYER.aics_equity_assets_info',
               'STD_LAYER.t08_equity_assets_info',
               query_date,
               'yes');
  exception
    -- error handling if exception happens
    when others then
      update_log('SRC_LAYER.aics_equity_assets_info',
                 'STD_LAYER.t08_equity_assets_info',
                 query_date,
                 'no',
                 sqlerrm);
      dbms_output.put_line(sqlerrm);
      rollback;
  end update_equity_assets_info;

  --update_invest_contract
  procedure update_invest_contract is
    query_date date;
  begin
    -- save query_date from etl_control
    select data_date
      into query_date
      from ETL_CONTROL.CTL_GENERAL_PARAMETER;
    -- remove duplicated record identified by data_date
    delete from STD_LAYER.t04_invest_contract
     where start_date = query_date;
    update STD_LAYER.t04_invest_contract
       set end_date = to_date('9999-12-31', 'yyyy/mm/dd')
     where end_date = query_date;
  
    merge into STD_LAYER.t04_invest_contract HIS
    using (select contractid,
                  projectcode,
                  rivalid,
                  contractno,
                  contractname,
                  signdate,
                  begdate,
                  prestopdate,
                  cykind,
                  contractbalance,
                  industry,
                  stcokamount,
                  investratio,
                  isrepurchase,
                  remark,
                  repurchaser,
                  extendillustration2,
                  stock_price,
                  investfundname,
                  interest,
                  stopinterestday,
                  startcountday,
                  debtamount,
                  accrualtaxrate,
                  startorg,
                  ischeckbycondition,
                  checkcondition,
                  maininvestpart,
                  isenjoyvoteright,
                  issendhighsup,
                  assetrate,
                  transferor,
                  dealtype,
                  purchasebanlance,
                  transfermoney,
                  paymenttype,
                  fxassetrate,
                  otherremark,
                  profitlevel,
                  investplantype,
                  underdescr
             from SRC_LAYER.aics_invest_contract
           minus
           select contractid,
                  projectcode,
                  rivalid,
                  contractno,
                  contractname,
                  signdate,
                  begdate,
                  prestopdate,
                  cykind,
                  contractbalance,
                  industry,
                  stcokamount,
                  investratio,
                  isrepurchase,
                  remark,
                  repurchaser,
                  extendillustration2,
                  stock_price,
                  investfundname,
                  interest,
                  stopinterestday,
                  startcountday,
                  debtamount,
                  accrualtaxrate,
                  startorg,
                  ischeckbycondition,
                  checkcondition,
                  maininvestpart,
                  isenjoyvoteright,
                  issendhighsup,
                  assetrate,
                  transferor,
                  dealtype,
                  purchasebanlance,
                  transfermoney,
                  paymenttype,
                  fxassetrate,
                  otherremark,
                  profitlevel,
                  investplantype,
                  underdescr
           
             from STD_LAYER.t04_invest_contract) DIF
    on (HIS.contractid = DIF.contractid)
    when matched then
      update set HIS.end_date = query_date;
    -- insert the nonredundant(new) records
    insert into STD_LAYER.t04_invest_contract
      select contractid,
             projectcode,
             rivalid,
             contractno,
             contractname,
             signdate,
             begdate,
             prestopdate,
             cykind,
             contractbalance,
             industry,
             stcokamount,
             investratio,
             isrepurchase,
             remark,
             repurchaser,
             extendillustration2,
             stock_price,
             investfundname,
             interest,
             stopinterestday,
             startcountday,
             debtamount,
             accrualtaxrate,
             startorg,
             ischeckbycondition,
             checkcondition,
             maininvestpart,
             isenjoyvoteright,
             issendhighsup,
             assetrate,
             transferor,
             dealtype,
             purchasebanlance,
             transfermoney,
             paymenttype,
             fxassetrate,
             otherremark,
             profitlevel,
             investplantype,
             underdescr,
             sysdate,
             datadate,
             to_date('9999-12-31', 'yyyy/mm/dd')
        from SRC_LAYER.aics_invest_contract
       where contractid not in
             (select contractid
                from (select contractid,
                             projectcode,
                             rivalid,
                             contractno,
                             contractname,
                             signdate,
                             begdate,
                             prestopdate,
                             cykind,
                             contractbalance,
                             industry,
                             stcokamount,
                             investratio,
                             isrepurchase,
                             remark,
                             repurchaser,
                             extendillustration2,
                             stock_price,
                             investfundname,
                             interest,
                             stopinterestday,
                             startcountday,
                             debtamount,
                             accrualtaxrate,
                             startorg,
                             ischeckbycondition,
                             checkcondition,
                             maininvestpart,
                             isenjoyvoteright,
                             issendhighsup,
                             assetrate,
                             transferor,
                             dealtype,
                             purchasebanlance,
                             transfermoney,
                             paymenttype,
                             fxassetrate,
                             otherremark,
                             profitlevel,
                             investplantype,
                             underdescr
                        from SRC_LAYER.aics_invest_contract
                      intersect
                      select contractid,
                             projectcode,
                             rivalid,
                             contractno,
                             contractname,
                             signdate,
                             begdate,
                             prestopdate,
                             cykind,
                             contractbalance,
                             industry,
                             stcokamount,
                             investratio,
                             isrepurchase,
                             remark,
                             repurchaser,
                             extendillustration2,
                             stock_price,
                             investfundname,
                             interest,
                             stopinterestday,
                             startcountday,
                             debtamount,
                             accrualtaxrate,
                             startorg,
                             ischeckbycondition,
                             checkcondition,
                             maininvestpart,
                             isenjoyvoteright,
                             issendhighsup,
                             assetrate,
                             transferor,
                             dealtype,
                             purchasebanlance,
                             transfermoney,
                             paymenttype,
                             fxassetrate,
                             otherremark,
                             profitlevel,
                             investplantype,
                             underdescr
                        from STD_LAYER.t04_invest_contract));
    commit;
  
    -- update system log in etl_control
    update_log('SRC_LAYER.aics_invest_contract',
               'STD_LAYER.t04_invest_contract',
               query_date,
               'yes');
  exception
    -- error handling if exception happens
    when others then
      update_log('SRC_LAYER.aics_invest_contract',
                 'STD_LAYER.t04_invest_contract',
                 query_date,
                 'no',
                 sqlerrm);
      dbms_output.put_line(sqlerrm);
      rollback;
  end update_invest_contract;

  --update_invest_fundvary
  procedure update_invest_fundvary is
    query_date date;
  begin
    -- save query_date from etl_control
    select data_date
      into query_date
      from ETL_CONTROL.CTL_GENERAL_PARAMETER;
    -- remove duplicated record identified by data_date
    delete from STD_LAYER.t08_invest_fundvary
     where start_date = query_date;
    update STD_LAYER.t08_invest_fundvary
       set end_date = to_date('9999-12-31', 'yyyy/mm/dd')
     where end_date = query_date;
  
    merge into STD_LAYER.t08_invest_fundvary HIS
    using (select ijourid,
                  batchid,
                  preoccurdate,
                  occurdate,
                  projectcode,
                  subprojectcode,
                  investcode,
                  contractid,
                  assetid,
                  fundacid,
                  rivalid,
                  accoid,
                  cykind,
                  busiflag,
                  investtype,
                  investway,
                  funddir,
                  stockdir,
                  repayway,
                  extflag,
                  preoccur_balance,
                  principal,
                  begindate,
                  enddate,
                  profit,
                  deduction,
                  occur_balance,
                  payway,
                  isinvalid,
                  remark,
                  checkflag,
                  cretaway,
                  createtime,
                  createuser,
                  updatetime,
                  updateuser,
                  stcokamount,
                  investratio,
                  instanceid,
                  delaydays,
                  paymenaccount,
                  deposittype,
                  deposittransfertype,
                  process_instanceid,
                  stockamount,
                  postflag,
                  realinvestdate,
                  equityratio
             from SRC_LAYER.aics_invest_fundvary
           minus
           select ijourid,
                  batchid,
                  preoccurdate,
                  occurdate,
                  projectcode,
                  subprojectcode,
                  investcode,
                  contractid,
                  assetid,
                  fundacid,
                  rivalid,
                  accoid,
                  cykind,
                  busiflag,
                  investtype,
                  investway,
                  funddir,
                  stockdir,
                  repayway,
                  extflag,
                  preoccur_balance,
                  principal,
                  begindate,
                  enddate,
                  profit,
                  deduction,
                  occur_balance,
                  payway,
                  isinvalid,
                  remark,
                  checkflag,
                  cretaway,
                  createtime,
                  createuser,
                  updatetime,
                  updateuser,
                  stcokamount,
                  investratio,
                  instanceid,
                  delaydays,
                  paymenaccount,
                  deposittype,
                  deposittransfertype,
                  process_instanceid,
                  stockamount,
                  postflag,
                  realinvestdate,
                  equityratio
           
             from STD_LAYER.t08_invest_fundvary) DIF
    on (HIS.ijourid = DIF.ijourid)
    when matched then
      update set HIS.end_date = query_date;
    -- insert the nonredundant(new) records
    insert into STD_LAYER.t08_invest_fundvary
      select ijourid,
             batchid,
             preoccurdate,
             occurdate,
             projectcode,
             subprojectcode,
             investcode,
             contractid,
             assetid,
             fundacid,
             rivalid,
             accoid,
             cykind,
             busiflag,
             investtype,
             investway,
             funddir,
             stockdir,
             repayway,
             extflag,
             preoccur_balance,
             principal,
             begindate,
             enddate,
             profit,
             deduction,
             occur_balance,
             payway,
             isinvalid,
             remark,
             checkflag,
             cretaway,
             createtime,
             createuser,
             updatetime,
             updateuser,
             stcokamount,
             investratio,
             instanceid,
             delaydays,
             paymenaccount,
             deposittype,
             deposittransfertype,
             process_instanceid,
             stockamount,
             postflag,
             realinvestdate,
             equityratio,
             sysdate,
             datadate,
             to_date('9999-12-31', 'yyyy/mm/dd')
        from SRC_LAYER.aics_invest_fundvary
       where ijourid not in
             (select ijourid
                from (select ijourid,
                             batchid,
                             preoccurdate,
                             occurdate,
                             projectcode,
                             subprojectcode,
                             investcode,
                             contractid,
                             assetid,
                             fundacid,
                             rivalid,
                             accoid,
                             cykind,
                             busiflag,
                             investtype,
                             investway,
                             funddir,
                             stockdir,
                             repayway,
                             extflag,
                             preoccur_balance,
                             principal,
                             begindate,
                             enddate,
                             profit,
                             deduction,
                             occur_balance,
                             payway,
                             isinvalid,
                             remark,
                             checkflag,
                             cretaway,
                             createtime,
                             createuser,
                             updatetime,
                             updateuser,
                             stcokamount,
                             investratio,
                             instanceid,
                             delaydays,
                             paymenaccount,
                             deposittype,
                             deposittransfertype,
                             process_instanceid,
                             stockamount,
                             postflag,
                             realinvestdate,
                             equityratio
                        from SRC_LAYER.aics_invest_fundvary
                      intersect
                      select ijourid,
                             batchid,
                             preoccurdate,
                             occurdate,
                             projectcode,
                             subprojectcode,
                             investcode,
                             contractid,
                             assetid,
                             fundacid,
                             rivalid,
                             accoid,
                             cykind,
                             busiflag,
                             investtype,
                             investway,
                             funddir,
                             stockdir,
                             repayway,
                             extflag,
                             preoccur_balance,
                             principal,
                             begindate,
                             enddate,
                             profit,
                             deduction,
                             occur_balance,
                             payway,
                             isinvalid,
                             remark,
                             checkflag,
                             cretaway,
                             createtime,
                             createuser,
                             updatetime,
                             updateuser,
                             stcokamount,
                             investratio,
                             instanceid,
                             delaydays,
                             paymenaccount,
                             deposittype,
                             deposittransfertype,
                             process_instanceid,
                             stockamount,
                             postflag,
                             realinvestdate,
                             equityratio
                        from STD_LAYER.t08_invest_fundvary));
    commit;
  
    -- update system log in etl_control
    update_log('SRC_LAYER.aics_invest_fundvary',
               'STD_LAYER.t08_invest_fundvary',
               query_date,
               'yes');
  exception
    -- error handling if exception happens
    when others then
      update_log('SRC_LAYER.aics_invest_fundvary',
                 'STD_LAYER.t08_invest_fundvary',
                 query_date,
                 'no',
                 sqlerrm);
      dbms_output.put_line(sqlerrm);
      rollback;
  end update_invest_fundvary;

  --update_invest_profitdetail
  procedure update_invest_profitdetail is
    query_date date;
  begin
    -- save query_date from etl_control
    select data_date
      into query_date
      from ETL_CONTROL.CTL_GENERAL_PARAMETER;
    -- remove duplicated record identified by data_date
    delete from STD_LAYER.t08_invest_profitdetail
     where start_date = query_date;
    update STD_LAYER.t08_invest_profitdetail
       set end_date = to_date('9999-12-31', 'yyyy/mm/dd')
     where end_date = query_date;
  
    merge into STD_LAYER.t08_invest_profitdetail HIS
    using (select pkid,
                  ijourid,
                  projectcode,
                  subprojectcode,
                  investcode,
                  contractid,
                  assetid,
                  repayway,
                  extflag,
                  profitkind,
                  occur_invest,
                  bdate,
                  edate,
                  settldate,
                  calcway,
                  rate,
                  profit,
                  balance,
                  afflid,
                  modiflag,
                  status,
                  rateid,
                  planid,
                  remark,
                  remitstatus,
                  extid,
                  days,
                  ratedays,
                  loanaccountcode,
                  repay_confirmdetail_id
             from SRC_LAYER.aics_invest_profitdetail
           minus
           select pkid,
                  ijourid,
                  projectcode,
                  subprojectcode,
                  investcode,
                  contractid,
                  assetid,
                  repayway,
                  extflag,
                  profitkind,
                  occur_invest,
                  bdate,
                  edate,
                  settldate,
                  calcway,
                  rate,
                  profit,
                  balance,
                  afflid,
                  modiflag,
                  status,
                  rateid,
                  planid,
                  remark,
                  remitstatus,
                  extid,
                  days,
                  ratedays,
                  loanaccountcode,
                  repay_confirmdetail_id
           
             from STD_LAYER.t08_invest_profitdetail) DIF
    on (HIS.pkid = DIF.pkid)
    when matched then
      update set HIS.end_date = query_date;
    -- insert the nonredundant(new) records
    insert into STD_LAYER.t08_invest_profitdetail
      select pkid,
             ijourid,
             projectcode,
             subprojectcode,
             investcode,
             contractid,
             assetid,
             repayway,
             extflag,
             profitkind,
             occur_invest,
             bdate,
             edate,
             settldate,
             calcway,
             rate,
             profit,
             balance,
             afflid,
             modiflag,
             status,
             rateid,
             planid,
             remark,
             remitstatus,
             extid,
             days,
             ratedays,
             loanaccountcode,
             repay_confirmdetail_id,
             sysdate,
             datadate,
             to_date('9999-12-31', 'yyyy/mm/dd')
        from SRC_LAYER.aics_invest_profitdetail
       where pkid not in
             (select pkid
                from (select pkid,
                             ijourid,
                             projectcode,
                             subprojectcode,
                             investcode,
                             contractid,
                             assetid,
                             repayway,
                             extflag,
                             profitkind,
                             occur_invest,
                             bdate,
                             edate,
                             settldate,
                             calcway,
                             rate,
                             profit,
                             balance,
                             afflid,
                             modiflag,
                             status,
                             rateid,
                             planid,
                             remark,
                             remitstatus,
                             extid,
                             days,
                             ratedays,
                             loanaccountcode,
                             repay_confirmdetail_id
                        from SRC_LAYER.aics_invest_profitdetail
                      intersect
                      select pkid,
                             ijourid,
                             projectcode,
                             subprojectcode,
                             investcode,
                             contractid,
                             assetid,
                             repayway,
                             extflag,
                             profitkind,
                             occur_invest,
                             bdate,
                             edate,
                             settldate,
                             calcway,
                             rate,
                             profit,
                             balance,
                             afflid,
                             modiflag,
                             status,
                             rateid,
                             planid,
                             remark,
                             remitstatus,
                             extid,
                             days,
                             ratedays,
                             loanaccountcode,
                             repay_confirmdetail_id
                        from STD_LAYER.t08_invest_profitdetail));
    commit;
  
    -- update system log in etl_control
    update_log('SRC_LAYER.aics_invest_profitdetail',
               'STD_LAYER.t08_invest_profitdetail',
               query_date,
               'yes');
  exception
    -- error handling if exception happens
    when others then
      update_log('SRC_LAYER.aics_invest_profitdetail',
                 'STD_LAYER.t08_invest_profitdetail',
                 query_date,
                 'no',
                 sqlerrm);
      dbms_output.put_line(sqlerrm);
      rollback;
  end update_invest_profitdetail;

  --update_project_info
  procedure update_project_info is
    query_date date;
  begin
    -- save query_date from etl_control
    select data_date
      into query_date
      from ETL_CONTROL.CTL_GENERAL_PARAMETER;
    -- remove duplicated record identified by data_date
    delete from STD_LAYER.t02_project_info where start_date = query_date;
    update STD_LAYER.t02_project_info
       set end_date = to_date('9999-12-31', 'yyyy/mm/dd')
     where end_date = query_date;
  
    merge into STD_LAYER.t02_project_info HIS
    using (select projectcode,
                  projectname,
                  projectnature,
                  projectphase,
                  risktype,
                  fdcbusitype,
                  projectstatus,
                  dptid,
                  depcode,
                  assetseller,
                  servicebank,
                  moneytype,
                  predictinvestdate,
                  trustmanager,
                  projectteammembers,
                  isperfectturnstock,
                  durdiligencelaunchorg,
                  pshorgno,
                  amccustomerno,
                  framesignedmoney,
                  applyinvestmoney,
                  producttype,
                  financingname,
                  belongtoindustry,
                  companynature,
                  creditrating,
                  istraded,
                  registeredcapital,
                  locatedarea,
                  predebtratio,
                  afterdebtratio,
                  extfield10,
                  predictinvestlimit,
                  investintentmemo,
                  channelcostmemo,
                  fundtrustee,
                  isneeddirector,
                  isneedsupervisor,
                  droptype,
                  dropdescribe,
                  predictyield,
                  predictyieldexplain,
                  debtsum,
                  debtcorpusamount,
                  debtinterest,
                  applyowninvestmoney,
                  isleavedebt,
                  leavedebtmoney,
                  leavedebtdescribe,
                  investedcompany,
                  financialproducttype,
                  financialproductcode,
                  prebalancesum,
                  timelimit,
                  distributionmode,
                  stockpremiumrate,
                  initstockprice,
                  parvaluerate,
                  redeemprice,
                  exchagnestockbeginday,
                  initpledgerate,
                  additionalguarantee,
                  lowrepairclause,
                  redemptionclause,
                  resaleclause,
                  isintermechanism,
                  servicecontentdescribe,
                  dbms_lob.substr(investtarget, 4000) as investtarget,
                  dbms_lob.substr(capital, 4000) as capital,
                  dbms_lob.substr(framework, 4000) as framework,
                  dbms_lob.substr(partyinfo, 4000) as partyinfo,
                  dbms_lob.substr(tasset, 4000) as tasset
             from SRC_LAYER.aics_project_info
           minus
           select projectcode,
                  projectname,
                  projectnature,
                  projectphase,
                  risktype,
                  fdcbusitype,
                  projectstatus,
                  dptid,
                  depcode,
                  assetseller,
                  servicebank,
                  moneytype,
                  predictinvestdate,
                  trustmanager,
                  projectteammembers,
                  isperfectturnstock,
                  durdiligencelaunchorg,
                  pshorgno,
                  amccustomerno,
                  framesignedmoney,
                  applyinvestmoney,
                  producttype,
                  financingname,
                  belongtoindustry,
                  companynature,
                  creditrating,
                  istraded,
                  registeredcapital,
                  locatedarea,
                  predebtratio,
                  afterdebtratio,
                  extfield10,
                  predictinvestlimit,
                  investintentmemo,
                  channelcostmemo,
                  fundtrustee,
                  isneeddirector,
                  isneedsupervisor,
                  droptype,
                  dropdescribe,
                  predictyield,
                  predictyieldexplain,
                  debtsum,
                  debtcorpusamount,
                  debtinterest,
                  applyowninvestmoney,
                  isleavedebt,
                  leavedebtmoney,
                  leavedebtdescribe,
                  investedcompany,
                  financialproducttype,
                  financialproductcode,
                  prebalancesum,
                  timelimit,
                  distributionmode,
                  stockpremiumrate,
                  initstockprice,
                  parvaluerate,
                  redeemprice,
                  exchagnestockbeginday,
                  initpledgerate,
                  additionalguarantee,
                  lowrepairclause,
                  redemptionclause,
                  resaleclause,
                  isintermechanism,
                  servicecontentdescribe,
                  dbms_lob.substr(investtarget, 4000) as investtarget,
                  dbms_lob.substr(capital, 4000) as capital,
                  dbms_lob.substr(framework, 4000) as framework,
                  dbms_lob.substr(partyinfo, 4000) as partyinfo,
                  dbms_lob.substr(tasset, 4000) as tasset
           
             from STD_LAYER.t02_project_info) DIF
    on (HIS.projectcode = DIF.projectcode)
    when matched then
      update set HIS.end_date = query_date;
    -- insert the nonredundant(new) records
    insert into STD_LAYER.t02_project_info
      select projectcode,
             projectname,
             projectnature,
             projectphase,
             risktype,
             fdcbusitype,
             projectstatus,
             dptid,
             depcode,
             assetseller,
             servicebank,
             moneytype,
             predictinvestdate,
             trustmanager,
             projectteammembers,
             isperfectturnstock,
             durdiligencelaunchorg,
             pshorgno,
             amccustomerno,
             framesignedmoney,
             applyinvestmoney,
             producttype,
             financingname,
             belongtoindustry,
             companynature,
             creditrating,
             istraded,
             registeredcapital,
             locatedarea,
             predebtratio,
             afterdebtratio,
             extfield10,
             predictinvestlimit,
             investintentmemo,
             channelcostmemo,
             fundtrustee,
             isneeddirector,
             isneedsupervisor,
             droptype,
             dropdescribe,
             predictyield,
             predictyieldexplain,
             debtsum,
             debtcorpusamount,
             debtinterest,
             applyowninvestmoney,
             isleavedebt,
             leavedebtmoney,
             leavedebtdescribe,
             investedcompany,
             financialproducttype,
             financialproductcode,
             prebalancesum,
             timelimit,
             distributionmode,
             stockpremiumrate,
             initstockprice,
             parvaluerate,
             redeemprice,
             exchagnestockbeginday,
             initpledgerate,
             additionalguarantee,
             lowrepairclause,
             redemptionclause,
             resaleclause,
             isintermechanism,
             servicecontentdescribe,
             investtarget,
             capital,
             framework,
             partyinfo,
             tasset,
             sysdate,
             datadate,
             to_date('9999-12-31', 'yyyy/mm/dd')
        from SRC_LAYER.aics_project_info
       where projectcode not in
             (select projectcode
                from (select projectcode,
                             projectname,
                             projectnature,
                             projectphase,
                             risktype,
                             fdcbusitype,
                             projectstatus,
                             dptid,
                             depcode,
                             assetseller,
                             servicebank,
                             moneytype,
                             predictinvestdate,
                             trustmanager,
                             projectteammembers,
                             isperfectturnstock,
                             durdiligencelaunchorg,
                             pshorgno,
                             amccustomerno,
                             framesignedmoney,
                             applyinvestmoney,
                             producttype,
                             financingname,
                             belongtoindustry,
                             companynature,
                             creditrating,
                             istraded,
                             registeredcapital,
                             locatedarea,
                             predebtratio,
                             afterdebtratio,
                             extfield10,
                             predictinvestlimit,
                             investintentmemo,
                             channelcostmemo,
                             fundtrustee,
                             isneeddirector,
                             isneedsupervisor,
                             droptype,
                             dropdescribe,
                             predictyield,
                             predictyieldexplain,
                             debtsum,
                             debtcorpusamount,
                             debtinterest,
                             applyowninvestmoney,
                             isleavedebt,
                             leavedebtmoney,
                             leavedebtdescribe,
                             investedcompany,
                             financialproducttype,
                             financialproductcode,
                             prebalancesum,
                             timelimit,
                             distributionmode,
                             stockpremiumrate,
                             initstockprice,
                             parvaluerate,
                             redeemprice,
                             exchagnestockbeginday,
                             initpledgerate,
                             additionalguarantee,
                             lowrepairclause,
                             redemptionclause,
                             resaleclause,
                             isintermechanism,
                             servicecontentdescribe,
                             dbms_lob.substr(investtarget, 4000) as investtarget,
                             dbms_lob.substr(capital, 4000) as capital,
                             dbms_lob.substr(framework, 4000) as framework,
                             dbms_lob.substr(partyinfo, 4000) as partyinfo,
                             dbms_lob.substr(tasset, 4000) as tasset
                        from SRC_LAYER.aics_project_info
                      intersect
                      select projectcode,
                             projectname,
                             projectnature,
                             projectphase,
                             risktype,
                             fdcbusitype,
                             projectstatus,
                             dptid,
                             depcode,
                             assetseller,
                             servicebank,
                             moneytype,
                             predictinvestdate,
                             trustmanager,
                             projectteammembers,
                             isperfectturnstock,
                             durdiligencelaunchorg,
                             pshorgno,
                             amccustomerno,
                             framesignedmoney,
                             applyinvestmoney,
                             producttype,
                             financingname,
                             belongtoindustry,
                             companynature,
                             creditrating,
                             istraded,
                             registeredcapital,
                             locatedarea,
                             predebtratio,
                             afterdebtratio,
                             extfield10,
                             predictinvestlimit,
                             investintentmemo,
                             channelcostmemo,
                             fundtrustee,
                             isneeddirector,
                             isneedsupervisor,
                             droptype,
                             dropdescribe,
                             predictyield,
                             predictyieldexplain,
                             debtsum,
                             debtcorpusamount,
                             debtinterest,
                             applyowninvestmoney,
                             isleavedebt,
                             leavedebtmoney,
                             leavedebtdescribe,
                             investedcompany,
                             financialproducttype,
                             financialproductcode,
                             prebalancesum,
                             timelimit,
                             distributionmode,
                             stockpremiumrate,
                             initstockprice,
                             parvaluerate,
                             redeemprice,
                             exchagnestockbeginday,
                             initpledgerate,
                             additionalguarantee,
                             lowrepairclause,
                             redemptionclause,
                             resaleclause,
                             isintermechanism,
                             servicecontentdescribe,
                             dbms_lob.substr(investtarget, 4000) as investtarget,
                             dbms_lob.substr(capital, 4000) as capital,
                             dbms_lob.substr(framework, 4000) as framework,
                             dbms_lob.substr(partyinfo, 4000) as partyinfo,
                             dbms_lob.substr(tasset, 4000) as tasset
                        from STD_LAYER.t02_project_info));
    commit;
  
    -- update system log in etl_control
    update_log('SRC_LAYER.aics_project_info',
               'STD_LAYER.t02_project_info',
               query_date,
               'yes');
  exception
    -- error handling if exception happens
    when others then
      update_log('SRC_LAYER.aics_project_info',
                 'STD_LAYER.t02_project_info',
                 query_date,
                 'no',
                 sqlerrm);
      dbms_output.put_line(sqlerrm);
      rollback;
  end update_project_info;

  --update_repay_info
  procedure update_repay_info is
    query_date date;
  begin
    -- save query_date from etl_control
    select data_date
      into query_date
      from ETL_CONTROL.CTL_GENERAL_PARAMETER;
    -- remove duplicated record identified by data_date
    delete from STD_LAYER.t05_repay_info where start_date = query_date;
    update STD_LAYER.t05_repay_info
       set end_date = to_date('9999-12-31', 'yyyy/mm/dd')
     where end_date = query_date;
  
    merge into STD_LAYER.t05_repay_info HIS
    using (select id,
                  process_instanceid,
                  projectcode,
                  contractid,
                  loanaccountcode,
                  type,
                  rivalid,
                  accoid,
                  cykind,
                  preoccurdate,
                  preoccur_balance,
                  occur_balance,
                  payable,
                  purchase,
                  deposittype,
                  isdebts,
                  remark,
                  invoice,
                  payway,
                  paysource,
                  checkflag,
                  creater,
                  create_date,
                  isoutpace,
                  afflid,
                  isdebtsloan,
                  ouramount,
                  customerfund,
                  subjectno,
                  acquisitiontype,
                  contractstate,
                  contractcheck,
                  contractexamine,
                  approvestate,
                  approvecheck,
                  approveexamine,
                  approvepid,
                  contractpid,
                  paystatus,
                  acconame,
                  bankname,
                  bankacco,
                  taxamount,
                  usercode,
                  receiptcode,
                  receiptdate,
                  reimburseunit,
                  department,
                  pay_description,
                  errormsg,
                  batchno,
                  rincome,
                  rcapital,
                  repayplanid,
                  istocapitalsys,
                  amount_without_tax,
                  other_payname,
                  equity_invest_type,
                  payment_number_no,
                  payment_number_name,
                  fund_carry_out,
                  payment_company,
                  approve_no,
                  pay_category
             from SRC_LAYER.aics_repay_info
           minus
           select id,
                  process_instanceid,
                  projectcode,
                  contractid,
                  loanaccountcode,
                  type,
                  rivalid,
                  accoid,
                  cykind,
                  preoccurdate,
                  preoccur_balance,
                  occur_balance,
                  payable,
                  purchase,
                  deposittype,
                  isdebts,
                  remark,
                  invoice,
                  payway,
                  paysource,
                  checkflag,
                  creater,
                  create_date,
                  isoutpace,
                  afflid,
                  isdebtsloan,
                  ouramount,
                  customerfund,
                  subjectno,
                  acquisitiontype,
                  contractstate,
                  contractcheck,
                  contractexamine,
                  approvestate,
                  approvecheck,
                  approveexamine,
                  approvepid,
                  contractpid,
                  paystatus,
                  acconame,
                  bankname,
                  bankacco,
                  taxamount,
                  usercode,
                  receiptcode,
                  receiptdate,
                  reimburseunit,
                  department,
                  pay_description,
                  errormsg,
                  batchno,
                  rincome,
                  rcapital,
                  repayplanid,
                  istocapitalsys,
                  amount_without_tax,
                  other_payname,
                  equity_invest_type,
                  payment_number_no,
                  payment_number_name,
                  fund_carry_out,
                  payment_company,
                  approve_no,
                  pay_category
           
             from STD_LAYER.t05_repay_info) DIF
    on (HIS.id = DIF.id)
    when matched then
      update set HIS.end_date = query_date;
    -- insert the nonredundant(new) records
    insert into STD_LAYER.t05_repay_info
      select id,
             process_instanceid,
             projectcode,
             contractid,
             loanaccountcode,
             type,
             rivalid,
             accoid,
             cykind,
             preoccurdate,
             preoccur_balance,
             occur_balance,
             payable,
             purchase,
             deposittype,
             isdebts,
             remark,
             invoice,
             payway,
             paysource,
             checkflag,
             creater,
             create_date,
             isoutpace,
             afflid,
             isdebtsloan,
             ouramount,
             customerfund,
             subjectno,
             acquisitiontype,
             contractstate,
             contractcheck,
             contractexamine,
             approvestate,
             approvecheck,
             approveexamine,
             approvepid,
             contractpid,
             paystatus,
             acconame,
             bankname,
             bankacco,
             taxamount,
             usercode,
             receiptcode,
             receiptdate,
             reimburseunit,
             department,
             pay_description,
             errormsg,
             batchno,
             rincome,
             rcapital,
             repayplanid,
             istocapitalsys,
             amount_without_tax,
             other_payname,
             equity_invest_type,
             payment_number_no,
             payment_number_name,
             fund_carry_out,
             payment_company,
             approve_no,
             pay_category,
             sysdate,
             datadate,
             to_date('9999-12-31', 'yyyy/mm/dd')
        from SRC_LAYER.aics_repay_info
       where id not in (select id
                          from (select id,
                                       process_instanceid,
                                       projectcode,
                                       contractid,
                                       loanaccountcode,
                                       type,
                                       rivalid,
                                       accoid,
                                       cykind,
                                       preoccurdate,
                                       preoccur_balance,
                                       occur_balance,
                                       payable,
                                       purchase,
                                       deposittype,
                                       isdebts,
                                       remark,
                                       invoice,
                                       payway,
                                       paysource,
                                       checkflag,
                                       creater,
                                       create_date,
                                       isoutpace,
                                       afflid,
                                       isdebtsloan,
                                       ouramount,
                                       customerfund,
                                       subjectno,
                                       acquisitiontype,
                                       contractstate,
                                       contractcheck,
                                       contractexamine,
                                       approvestate,
                                       approvecheck,
                                       approveexamine,
                                       approvepid,
                                       contractpid,
                                       paystatus,
                                       acconame,
                                       bankname,
                                       bankacco,
                                       taxamount,
                                       usercode,
                                       receiptcode,
                                       receiptdate,
                                       reimburseunit,
                                       department,
                                       pay_description,
                                       errormsg,
                                       batchno,
                                       rincome,
                                       rcapital,
                                       repayplanid,
                                       istocapitalsys,
                                       amount_without_tax,
                                       other_payname,
                                       equity_invest_type,
                                       payment_number_no,
                                       payment_number_name,
                                       fund_carry_out,
                                       payment_company,
                                       approve_no,
                                       pay_category
                                  from SRC_LAYER.aics_repay_info
                                intersect
                                select id,
                                       process_instanceid,
                                       projectcode,
                                       contractid,
                                       loanaccountcode,
                                       type,
                                       rivalid,
                                       accoid,
                                       cykind,
                                       preoccurdate,
                                       preoccur_balance,
                                       occur_balance,
                                       payable,
                                       purchase,
                                       deposittype,
                                       isdebts,
                                       remark,
                                       invoice,
                                       payway,
                                       paysource,
                                       checkflag,
                                       creater,
                                       create_date,
                                       isoutpace,
                                       afflid,
                                       isdebtsloan,
                                       ouramount,
                                       customerfund,
                                       subjectno,
                                       acquisitiontype,
                                       contractstate,
                                       contractcheck,
                                       contractexamine,
                                       approvestate,
                                       approvecheck,
                                       approveexamine,
                                       approvepid,
                                       contractpid,
                                       paystatus,
                                       acconame,
                                       bankname,
                                       bankacco,
                                       taxamount,
                                       usercode,
                                       receiptcode,
                                       receiptdate,
                                       reimburseunit,
                                       department,
                                       pay_description,
                                       errormsg,
                                       batchno,
                                       rincome,
                                       rcapital,
                                       repayplanid,
                                       istocapitalsys,
                                       amount_without_tax,
                                       other_payname,
                                       equity_invest_type,
                                       payment_number_no,
                                       payment_number_name,
                                       fund_carry_out,
                                       payment_company,
                                       approve_no,
                                       pay_category
                                  from STD_LAYER.t05_repay_info));
    commit;
  
    -- update system log in etl_control
    update_log('SRC_LAYER.aics_repay_info',
               'STD_LAYER.t05_repay_info',
               query_date,
               'yes');
  exception
    -- error handling if exception happens
    when others then
      update_log('SRC_LAYER.aics_repay_info',
                 'STD_LAYER.t05_repay_info',
                 query_date,
                 'no',
                 sqlerrm);
      dbms_output.put_line(sqlerrm);
      rollback;
  end update_repay_info;

  -- update log in etl_control
  procedure update_log(source_sheet      varchar2,
                       target_sheet      varchar2,
                       query_date        date,
                       success_status    varchar2,
                       exception_message varchar2 default NULL) is
  begin
    insert into etl_control.etl_control_log
      (etl_modle,
       etl_source,
       etl_target,
       data_date,
       etl_date,
       is_success,
       exceptionerrormsg)
    values
      ('STD_LAYER',
       source_sheet,
       target_sheet,
       query_date,
       sysdate,
       success_status,
       exception_message);
    commit;
  end update_log;

end ETL_process_aics;
/
