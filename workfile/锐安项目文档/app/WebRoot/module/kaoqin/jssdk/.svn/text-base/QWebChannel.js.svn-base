var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function a(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,n,t){return n&&a(e.prototype,n),t&&a(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var Device=function(){function n(){_classCallCheck(this,n);var e=navigator.userAgent.toLowerCase();-1!=e.indexOf("qtwebengine")?this.pc():-1!=e.indexOf("qtwebkit")&&this.xp()}return _createClass(n,[{key:"init",value:function(e){null!=e.debug&&(isDebug=e.debug)}},{key:"ready",value:function(e){null!=client?"function"==typeof e&&e.call(this):readyFn=e}},{key:"pc",value:function(){var a=this._callback;new QWebChannel(qt.webChannelTransport,function(e){(client=e.objects.content).callback.connect(function(e,n,t){a(e,n,t)}),readyFn&&readyFn.call(this)})}},{key:"xp",value:function(){var a=this._callback;(client=window.xplinkdood).callback.connect(function(e,n,t){a(e,n,t)}),readyFn&&readyFn.call(this)}},{key:"takePhoto",value:function(e){this._callByApp("takePhoto",e)}},{key:"getUnreadMessage",value:function(e){this._callByApp("getUnreadMessage",e)}},{key:"getAccountInfo",value:function(e){this._callByApp("getAccountInfo",e)}},{key:"sendMessage",value:function(e){this._callByApp("sendMessage",e)}},{key:"portraitUrl",value:function(e){this._callByApp("portraitUrl",e)}},{key:"getUserName",value:function(e){this._callByApp("getUserName",e)}},{key:"getContactList",value:function(e){this._callByApp("getContactList",e)}},{key:"getLocalFiles",value:function(e){e=this._setDefault(e,[{type:"number",key:"size",val:10,min:1,max:15}]),this._callByApp("getLocalFiles",e)}},{key:"getGroupList",value:function(e){this._callByApp("getGroupList",e)}},{key:"getLocalPhotos",value:function(e){e=this._setDefault(e,[{type:"number",key:"size",val:10,min:1,max:15}]),this._callByApp("getLocalPhotos",e)}},{key:"getPosition",value:function(e){this._callByApp("getPosition",e)}},{key:"showNavigationBar",value:function(e){this._callByApp("showNavigationBar",e)}},{key:"getInfoWithSweep",value:function(e){this._callByApp("getInfoWithSweep",e)}},{key:"getOrganization",value:function(e){this._callByApp("getOrganization",e)}},{key:"closeView",value:function(e){this._callByApp("closeView",e)}},{key:"getLanguage",value:function(e){this._callByApp("getLanguage",e)}},{key:"getVersionMark",value:function(e){this._callByApp("getVersionMark",e)}},{key:"copyTextToPaste",value:function(e){this._callByApp("copyTextToPaste",e)}},{key:"chatByUserID",value:function(e){this._callByApp("chatByUserID",e)}},{key:"openFileURL",value:function(e){this._callByApp("openFileURL",e)}},{key:"openImageURL",value:function(e){this._callByApp("openImageURL",e)}},{key:"registerMessageNotice",value:function(e){this._callByApp("registerMessageNotice",e)}},{key:"getVersion",value:function(e){a.success({version:sdkVersion,platform:"pc"})}},{key:"openChat",value:function(e){this._callByApp("openChat",e)}},{key:"createGroup",value:function(e){this._callByApp("createGroup",e)}},{key:"transferGroup",value:function(e){this._callByApp("transferGroup",e)}},{key:"joinGroup",value:function(e){this._callByApp("joinGroup",e)}},{key:"inviteMembers",value:function(e){this._callByApp("inviteMembers",e)}},{key:"removeMembers",value:function(e){this._callByApp("removeMembers",e)}},{key:"getGroupMembers",value:function(e){this._callByApp("getGroupMembers",e)}},{key:"deleteGroup",value:function(e){this._callByApp("deleteGroup",e)}},{key:"openAudioCall",value:function(e){this._callByApp("openAudioCall",e)}},{key:"openVideoCall",value:function(e){this._callByApp("openVideoCall",e)}},{key:"openVideoCallVendor",value:function(e){this._callByApp("openVideoCallVendor",e)}},{key:"getOAuthCode",value:function(e){this._callByApp("getOAuthCode",e)}},{key:"getUserIdMap",value:function(e){this._callByApp("getUserIdMap",e)}},{key:"scanQrCode",value:function(e){this._callByApp("scanQrCode",e)}},{key:"shareTo",value:function(e){this._callByApp("shareTo",e)}},{key:"readNfc",value:function(e){this._callByApp("readNfc",e)}},{key:"_callByApp",value:function(e,n){if(null!=client)if(isDebug&&alert("jssdk 初始化成功"),null!=e){var t=this._formatParams(n);n&&n.success&&"function"==typeof n.success&&(successCb[t.uuid]=n.success),"openChat"===e||"createGroup"===e||"deleteGroup"===e||"openAudioCall"===e||"openVideoCallVendor"===e||"getOAuthCode"===e||"getUserIdMap"===e||"scanQrCode"===e||"shareTo"===e?client[e](e,JSON.stringify(n),t.p):client[e](e,t.p)}else alert("调用方法名错误");else alert("请先初始化jssdk")}},{key:"_callback",value:function(e,n,t){try{var a;isDebug&&alert(e+":"+t),"registerMessageNotice"===e?a=successCb[JSON.parse(n).uuid]:(a=successCb[JSON.parse(n).uuid],delete successCb[JSON.parse(n).uuid]),"function"==typeof a&&a.call(this,JSON.parse(t))}catch(e){alert(e.message)}}},{key:"_setDefault",value:function(e,n){for(var t in e||(e={}),e.constructor!==Object&&(e={}),n){var a=n[t];_typeof(e[a.key])!=a.type&&(e[a.key]=a.val),(e[a.key]>a.max||e[a.key]<a.min)&&(e[a.key]=a.val)}return e}},{key:"_creatUUID",value:function(){for(var e=[],n="0123456789abcdef",t=0;t<36;t++)e[t]=n.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=n.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}},{key:"_formatParams",value:function(e){return e||(e={}),e.constructor!==Object&&(e={}),e.uuid=this._creatUUID(),{p:JSON.stringify(e),uuid:e.uuid}}}]),n}(),isDebug=!1,successCb={},QWebChannelMessageTypes={signal:1,propertyUpdate:2,init:3,idle:4,debug:5,invokeMethod:6,connectToSignal:7,disconnectFromSignal:8,setProperty:9,response:10},QWebChannel=function(e,t){if("object"===(void 0===e?"undefined":_typeof(e))&&"function"==typeof e.send){var o=this;this.transport=e,this.send=function(e){"string"!=typeof e&&(e=JSON.stringify(e)),o.transport.send(e)},this.transport.onmessage=function(e){var n=e.data;switch("string"==typeof n&&(n=JSON.parse(n)),n.type){case QWebChannelMessageTypes.signal:o.handleSignal(n);break;case QWebChannelMessageTypes.response:o.handleResponse(n);break;case QWebChannelMessageTypes.propertyUpdate:o.handlePropertyUpdate(n);break;default:console.error("invalid message received:",e.data)}},this.execCallbacks={},this.execId=0,this.exec=function(e,n){n?(o.execId===Number.MAX_VALUE&&(o.execId=Number.MIN_VALUE),e.hasOwnProperty("id")?console.error("Cannot exec message with property id: "+JSON.stringify(e)):(e.id=o.execId++,o.execCallbacks[e.id]=n,o.send(e))):o.send(e)},this.objects={},this.handleSignal=function(e){var n=o.objects[e.object];n?n.signalEmitted(e.signal,e.args):console.warn("Unhandled signal: "+e.object+"::"+e.signal)},this.handleResponse=function(e){e.hasOwnProperty("id")?(o.execCallbacks[e.id](e.data),delete o.execCallbacks[e.id]):console.error("Invalid response message received: ",JSON.stringify(e))},this.handlePropertyUpdate=function(e){for(var n in e.data){var t=e.data[n],a=o.objects[t.object];a?a.propertyUpdate(t.signals,t.properties):console.warn("Unhandled property update: "+t.object+"::"+t.signal)}o.exec({type:QWebChannelMessageTypes.idle})},this.debug=function(e){o.send({type:QWebChannelMessageTypes.debug,data:e})},o.exec({type:QWebChannelMessageTypes.init},function(e){for(var n in e)new QObject(n,e[n],o);for(var n in o.objects)o.objects[n].unwrapProperties();t&&t(o),o.exec({type:QWebChannelMessageTypes.idle})})}else console.error("The QWebChannel expects a transport object with a send function and onmessage callback property. Given is: transport: "+(void 0===e?"undefined":_typeof(e))+", transport.send: "+_typeof(e.send))};function QObject(e,n,i){this.__id__=e,(i.objects[e]=this).__objectSignals__={},this.__propertyCache__={};var s=this;function o(e,t){var a=e[0],o=e[1];s[a]={connect:function(e){"function"==typeof e?(s.__objectSignals__[o]=s.__objectSignals__[o]||[],s.__objectSignals__[o].push(e),t||"destroyed"===a||i.exec({type:QWebChannelMessageTypes.connectToSignal,object:s.__id__,signal:o})):console.error("Bad callback given to connect to signal "+a)},disconnect:function(e){if("function"==typeof e){s.__objectSignals__[o]=s.__objectSignals__[o]||[];var n=s.__objectSignals__[o].indexOf(e);-1!==n?(s.__objectSignals__[o].splice(n,1),t||0!==s.__objectSignals__[o].length||i.exec({type:QWebChannelMessageTypes.disconnectFromSignal,object:s.__id__,signal:o})):console.error("Cannot find connection of signal "+a+" to "+e.name)}else console.error("Bad callback given to disconnect from signal "+a)}}}function c(e,n){var t=s.__objectSignals__[e];t&&t.forEach(function(e){e.apply(e,n)})}for(var e in this.unwrapQObject=function(e){if(e instanceof Array){for(var n=new Array(e.length),t=0;t<e.length;++t)n[t]=s.unwrapQObject(e[t]);return n}if(!e||!e["__QObject*__"]||void 0===e.id)return e;var a=e.id;if(i.objects[a])return i.objects[a];if(e.data){var o=new QObject(a,e.data,i);return o.destroyed.connect(function(){if(i.objects[a]===o){delete i.objects[a];var e=[];for(var n in o)e.push(n);for(var t in e)delete o[e[t]]}}),o.unwrapProperties(),o}console.error("Cannot unwrap unknown QObject "+a+" without data.")},this.unwrapProperties=function(){for(var e in s.__propertyCache__)s.__propertyCache__[e]=s.unwrapQObject(s.__propertyCache__[e])},this.propertyUpdate=function(e,n){for(var t in n){var a=n[t];s.__propertyCache__[t]=a}for(var o in e)c(o,e[o])},this.signalEmitted=function(e,n){c(e,n)},n.methods.forEach(function(e){var n=e[0],a=e[1];s[n]=function(){for(var t,e=[],n=0;n<arguments.length;++n)"function"==typeof arguments[n]?t=arguments[n]:e.push(arguments[n]);i.exec({type:QWebChannelMessageTypes.invokeMethod,object:s.__id__,method:a,args:e},function(e){if(void 0!==e){var n=s.unwrapQObject(e);t&&t(n)}})}}),n.properties.forEach(function(e){var n=e[0],t=e[1],a=e[2];s.__propertyCache__[n]=e[3],a&&(1===a[0]&&(a[0]=t+"Changed"),o(a,!0)),Object.defineProperty(s,t,{configurable:!0,get:function(){var e=s.__propertyCache__[n];return void 0===e&&console.warn('Undefined value in property cache for property "'+t+'" in object '+s.__id__),e},set:function(e){void 0!==e?(s.__propertyCache__[n]=e,i.exec({type:QWebChannelMessageTypes.setProperty,object:s.__id__,property:n,value:e})):console.warn("Property setter for "+t+" called with undefined value!")}})}),n.signals.forEach(function(e){o(e,!1)}),n.enums)s[e]=n.enums[e]}"object"===("undefined"==typeof module?"undefined":_typeof(module))&&(module.exports={QWebChannel:QWebChannel});var sdkVersion="2.1",readyFn=null,client=null,vrv=new Device;vrv.jssdk=vrv;