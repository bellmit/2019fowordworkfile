SELECT YEAR(a.applydate) AS z_year                                        -- 提交日期年【例：2019】
      ,concat(YEAR(a.applydate), "Q", quarter(a.applydate)) AS z_quarter  -- 提交日期季度【例：2019Q1】
       ,date_format(a.applydate, '%Y-%m') AS z_month                      -- 提交日期月份【例：2019-01】
       ,a.applydate                                                       -- 提交日期
       ,a.xmbh                                                            -- 项目编号
       ,c.pm_name                                                         -- 项目描述
       ,b.lifnr                                                           -- 供应商编号
       ,a.cg_gys                                                          -- 供应商名称
       ,SUM(ifnull(a.gysmoney, 0)) AS gysmoney                            -- 采购金额
       ,SUM(ifnull(d.qt_amt, 0)) AS qt_amt                                -- 合同金额
  FROM cg_sp a                                                            
  LEFT JOIN (SELECT DISTINCT a.cg_sp_id
                            ,a.lifnr
                            ,a.offername
               FROM cg_sp_offer a) b ON a.id = b.cg_sp_id
                                    AND a.cg_gys = b.offername
  LEFT JOIN (SELECT *
               FROM (SELECT a.*
                           ,IF(@pmh = pmh, @rn := @rn + 1, @rn := 1) AS row_number
                           ,@pmh := pmh AS var1
                       FROM (SELECT DISTINCT a.pmh
                                            ,a.pm_name
                               FROM cg_sp_et a
                              WHERE a.pmh <> '') a
                           ,(SELECT @pmh := ''
                                  ,@rn  := 0) b
                      ORDER BY pmh) a
              WHERE row_number = 1) c ON a.xmbh = c.pmh
  LEFT JOIN (SELECT DISTINCT pspnr
                            ,qt_amt
               FROM sd_yszk) d ON a.xmbh = d.pspnr
 GROUP BY a.applydate     -- 提交日期
         ,a.xmbh          -- 项目编号
         ,c.pm_name       -- 项目描述
         ,b.lifnr         -- 供应商编号
         ,a.cg_gys        -- 供应商名称